{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Résultats de l'examen - {{ course.name }}</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        .correct-choice {
            color: green;
            font-weight: bold;
        }
        .incorrect-choice {
            color: red;
            font-weight: bold;
        }
        .card-question {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="container mt-5">

    <h2 class="mb-4">{{ course.name }} - Résultats de l'examen</h2>

    <!-- Score total et message -->
    <div class="alert {% if total_score >= total_points/2 %}alert-success{% else %}alert-danger{% endif %}">
        <h4>Score total : {{ total_score }} / {{ total_points }}</h4>
        {% if total_score >= total_points/2 %}
            <p>Félicitations ! Vous avez réussi l'examen.</p>
        {% else %}
            <p>Vous n'avez pas réussi l'examen. Vous pouvez réessayer.</p>
            <a href="{% url 'onlinecourse:course_details' course.id %}" class="btn btn-primary mt-2">Repasser l'examen</a>
        {% endif %}
    </div>

    <!-- Résultats détaillés par question -->
    {% for question in course.question_set.all %}
        <div class="card card-question">
            <div class="card-header">
                Question {{ forloop.counter }}: {{ question.question_text }} ({{ question.grade_point }} points)
            </div>
            <div class="card-body">
                {% for choice in question.choice_set.all %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" disabled
                               {% if choice in selected_choices %} checked {% endif %}>
                        <label class="form-check-label
                            {% if choice.is_correct %}correct-choice{% elif choice in selected_choices and not choice.is_correct %}incorrect-choice{% endif %}">
                            {{ choice.choice_text }}
                            {% if choice.is_correct %}(Correct){% endif %}
                        </label>
                    </div>
                {% endfor %}
                <!-- Message par question -->
                {% with selected_ids=selected_choices|dictsort:"id" %}
                    {% if question.is_get_score(selected_choices|filter:"question=question"|map:"id") %}
                        <p class="text-success mt-2">Résultat : Correct</p>
                    {% else %}
                        <p class="text-danger mt-2">Résultat : Incorrect</p>
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    {% endfor %}
</div>
</body>
</html>
